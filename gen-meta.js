const fs = require('fs');
const path = require('path');
const moment = require('moment');

const time = new Date();
const compileId = moment(time).format('YYYYMMDDHHmm');

const code = `// Generated by gen-meta.js
const appName = 'ClipCC';

const appVersion = '3.1.0';
const appVersionSimple = '3.1.0';
const appVersionFull = '3.0.99-b${compileId}';
const compileTime = '${time.toISOString()}'

export {
    appVersion, appVersionSimple, appVersionFull, compileTime
};
`;

fs.writeFileSync(path.join(__dirname, 'src/lib/app-info.js'), code);

const ENABLE_PWA = process.env.ENABLE_PWA;

if (ENABLE_PWA) {
    let data = fs.readFileSync(path.join(__dirname, 'static/sw.js'), { encoding: 'utf-8' });
    data = data.replace('gen@appVer', compileId);
    fs.writeFileSync(path.join(__dirname, 'static/sw.build.js'), data);
}
